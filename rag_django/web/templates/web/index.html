<!DOCTYPE html>
<html>
<head>
    <title>RAG Application</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            background: #f7f9fc;
        }

        .left, .right {
            padding: 20px;
        }

        .left {
            width: 30%;
            border-right: 1px solid #ddd;
            background: #ffffff;
            position: relative;
        }

        .right {
            width: 70%;
        }

        h3 {
            margin-top: 0;
        }

        button {
            padding: 8px 14px;
            border: none;
            background: #2563eb;
            color: white;
            cursor: pointer;
            border-radius: 4px;
        }

        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        input[type="file"],
        input[type="text"] {
            padding: 6px;
            margin-top: 10px;
        }

        .loader {
            margin-top: 15px;
            padding: 10px;
            background: #eef2ff;
            border-left: 4px solid #4f46e5;
            display: none;
        }

        .answer-box {
            margin-top: 20px;
            padding: 15px;
            background: #ffffff;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .user-badge {
            background: #e0e7ff;
            color: #1e3a8a;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>

<body>

<!-- LEFT PANEL -->
<div class="left">
    <h3>ðŸ“„ Upload PDFs</h3>

    <form method="post" enctype="multipart/form-data" onsubmit="startIndexing()">
        {% csrf_token %}
        <input type="file" name="files" multiple required />
        <br><br>
        <button type="submit" id="uploadBtn">Upload & Index</button>
    </form>

    <!-- Indexing Loader -->
    <div class="loader" id="loader">
        ðŸ”„ Indexing documents...  
        <br>
        Please donâ€™t refresh the page.
    </div>

    {% if job_id %}
        <input type="hidden" id="jobId" value="{{ job_id }}">
    {% endif %}

    <!-- LOGOUT BUTTON -->
    <div style="position:absolute; bottom:20px; width:85%;">
        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" style="
                width:100%;
                background:#dc2626;
                color:white;
                padding:10px;
                border-radius:6px;
            ">
                ðŸšª Logout
            </button>
        </form>
    </div>
</div>

<!-- RIGHT PANEL -->
<div class="right">

    <!-- USER INFO (TOP RIGHT) -->
    <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
        <span class="user-badge">
            ðŸ‘¤ {{ request.user.username|title }}
        </span>
    </div>

    <h3>ðŸ’¬ Ask Question</h3>

    <form action="/ask/" method="post">
        {% csrf_token %}
        <input type="text" name="question" style="width:80%" 
               placeholder="Ask something from the indexed PDFs..." required />
        <button type="submit">Ask</button>
    </form>

    {% if answer %}
        <div class="answer-box">
            <h4>âœ… Answer</h4>
            <p>{{ answer }}</p>

            <h5>ðŸ“Œ Sources</h5>
            <ul>
                {% for s in sources %}
                    <li>{{ s }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>

<script>
    function startIndexing() {
        document.getElementById("loader").style.display = "block";
        document.getElementById("uploadBtn").disabled = true;
    }
</script>

</body>
</html>
